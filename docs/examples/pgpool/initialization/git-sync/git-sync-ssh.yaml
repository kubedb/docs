apiVersion: kubedb.com/v1alpha2
kind: Pgpool
metadata:
  name: pgpool-demo
  namespace: demo
spec:
  version: "4.4.5"
  replicas: 1
  postgresRef:
    name: postgres
    namespace: demo
  initConfig:
    pgpoolConfig:
      num_init_children : 6
      max_pool : 65
      child_life_time : 400
  deletionPolicy: WipeOut
  init:
    script:
      scriptPath: current
      git:
        args:
          # use --ssh for private repository
          - --ssh
          - --repo=<YOUR-PRIVATE-repo-ssh-URL>
          - --depth=1
          - --period=60s
          - --link=current
          - --root=/init-script-from-git
          # terminate after successful sync
          - --one-time
        authSecret:
          name: git-creds
        # run as git sync user
        securityContext:
          runAsUser: 65533